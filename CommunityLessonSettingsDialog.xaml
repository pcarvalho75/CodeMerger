<Window x:Class="CodeMerger.CommunityLessonSettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Community Lessons Settings" Height="420" Width="520"
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize"
        Background="#1e1e2e">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Enable/Disable -->
        <CheckBox x:Name="enabledCheckBox" Grid.Row="0" Content="  Enable Community Lessons (sync shared lessons from GitHub)" 
                  Foreground="#cdd6f4" Margin="0,0,0,16" FontSize="13"
                  ToolTip="When enabled, CodeMerger periodically downloads community lessons from the configured repository. Disable to stop all syncing. Enabled by default."/>

        <!-- GitHub Sign In Section -->
        <Border Grid.Row="1" Background="#313244" CornerRadius="8" Padding="16" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="GitHub Account (optional)" FontWeight="SemiBold" Foreground="#cdd6f4" Margin="0,0,0,8"
                           ToolTip="Sign in with GitHub to get credit when submitting lessons. Reading community lessons does NOT require a GitHub account."/>

                <!-- Signed Out State -->
                <StackPanel x:Name="signedOutPanel" Grid.Row="1" Orientation="Horizontal">
                    <Button x:Name="signInButton" Content="ðŸ”‘ Sign in with GitHub" Click="SignIn_Click" 
                            Padding="12,6" Background="#238636" Foreground="White" BorderThickness="0" Cursor="Hand" FontWeight="SemiBold"
                            ToolTip="Opens your browser to authorize CodeMerger with GitHub. Uses Device Flow â€” no passwords are entered in this app. Only 'public_repo' scope is requested (to create issues for lesson submissions)."/>
                    <TextBlock Foreground="#6c7086" FontSize="11" VerticalAlignment="Center" Margin="12,0,0,0"
                               Text="Required only for submitting lessons"
                               ToolTip="You can read and sync community lessons without signing in. GitHub sign-in is only needed to submit your own lessons for review."/>
                </StackPanel>

                <!-- Signed In State -->
                <StackPanel x:Name="signedInPanel" Grid.Row="1" Orientation="Horizontal" Visibility="Collapsed">
                    <Border Background="#238636" CornerRadius="10" Padding="6,2" Margin="0,0,8,0">
                        <TextBlock Text="âœ“" Foreground="White" FontSize="10" VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock x:Name="usernameText" Foreground="#cdd6f4" VerticalAlignment="Center" FontWeight="SemiBold"
                               ToolTip="Your GitHub username. This will appear as the contributor when you submit lessons."/>
                    <Button x:Name="signOutButton" Content="Sign out" Click="SignOut_Click" Margin="12,0,0,0"
                            Padding="8,4" Background="Transparent" Foreground="#f38ba8" BorderThickness="0" Cursor="Hand" FontSize="11"
                            ToolTip="Remove stored GitHub token and username. You can sign in again at any time."/>
                </StackPanel>

                <!-- Signing In State (device code flow) -->
                <StackPanel x:Name="signingInPanel" Grid.Row="1" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Enter this code in your browser:" Foreground="#cdd6f4" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <Border Background="#1e1e2e" CornerRadius="4" Padding="12,4">
                            <TextBlock x:Name="deviceCodeText" Foreground="#f9e2af" FontSize="18" FontWeight="Bold" FontFamily="Consolas"
                                       ToolTip="Copy this code and paste it in the GitHub page that opened in your browser."/>
                        </Border>
                        <Button x:Name="copyCodeButton" Content="ðŸ“‹" Click="CopyCode_Click" Margin="8,0,0,0"
                                Padding="6,4" Background="Transparent" Foreground="#cdd6f4" BorderThickness="0" Cursor="Hand"
                                ToolTip="Copy the device code to clipboard"/>
                    </StackPanel>
                    <TextBlock x:Name="signingInStatus" Text="Waiting for authorization..." Foreground="#6c7086" FontSize="11"
                               ToolTip="After entering the code in your browser and clicking 'Authorize', this dialog will automatically detect the authorization and sign you in."/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Repo URL -->
        <Grid Grid.Row="2" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="130"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Repository URL:" Foreground="#cdd6f4" VerticalAlignment="Center"
                       ToolTip="The GitHub repository that hosts the community-lessons.json file. Default is the CodeMerger repo. Change this only if you want to use a different lesson source."/>
            <TextBox x:Name="repoUrlTextBox" Grid.Column="1" Padding="6,4"
                     Background="#313244" Foreground="#cdd6f4" BorderBrush="#45475a"
                     ToolTip="Full GitHub repository URL (e.g. https://github.com/pcarvalho75/CodeMerger). The sync service fetches community-lessons/community-lessons.json from the raw content URL."/>
        </Grid>

        <!-- Sync Interval -->
        <Grid Grid.Row="3" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="130"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Sync every:" Foreground="#cdd6f4" VerticalAlignment="Center"
                       ToolTip="How often CodeMerger checks for new community lessons. The check happens on application startup. Set to 0 to sync every time."/>
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <TextBox x:Name="syncIntervalTextBox" Width="50" Padding="6,4"
                         Background="#313244" Foreground="#cdd6f4" BorderBrush="#45475a"
                         ToolTip="Number of hours between sync checks. Default is 24 (once per day). Minimum is 1."/>
                <TextBlock Text=" hours" Foreground="#6c7086" VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Info -->
        <Border Grid.Row="4" Background="#313244" CornerRadius="6" Padding="12" Margin="0,0,0,4">
            <StackPanel>
                <TextBlock Foreground="#a6adc8" FontSize="11" TextWrapping="Wrap" LineHeight="18"
                           Text="ðŸ“– Reading lessons â€” No account needed. Works out of the box.&#x0a;ðŸ“¤ Submitting lessons â€” Requires GitHub sign-in. Your lesson is posted as a GitHub Issue on the repository for review by maintainers. Approved lessons become available to all CodeMerger users."
                           ToolTip="Community lessons are curated by the repository maintainer. Submissions go through GitHub Issues where they can be discussed, refined, and eventually merged into the community-lessons.json file."/>
            </StackPanel>
        </Border>

        <!-- Spacer -->
        <Border Grid.Row="5"/>

        <!-- Buttons -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Save" Click="Save_Click" Width="80" Padding="6,6"
                    Background="#89b4fa" Foreground="#1e1e2e" FontWeight="SemiBold" BorderThickness="0" Cursor="Hand"
                    ToolTip="Save settings and close. Changes take effect immediately."/>
            <Button Content="Cancel" Click="Cancel_Click" Width="80" Padding="6,6" Margin="8,0,0,0"
                    Background="#45475a" Foreground="#cdd6f4" BorderThickness="0" Cursor="Hand"
                    ToolTip="Close without saving changes."/>
        </StackPanel>
    </Grid>
</Window>
